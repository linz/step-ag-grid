import{l as be,w as le,o as D,A as et,T as tt,f as st,j as ye}from"./util-Do7DUC2X.js";import{R as lt,S as M,T as Ce,H as ot,U as ge}from"./GridWrapper-BAUk9ZaG.js";import{r as l}from"./iframe-fuNulc0f.js";import{W as nt,q as ae,X as rt,d as at,x as ct,Y as it,J as Ie,U as H,Q as q,Z as dt,u as te,_ as ut,$ as ft,b as Ct,a0 as gt}from"./Grid-CF0nfSDW.js";import"./client-DUEhelG0.js";function pt(s,n){var r=-1,e=s.length;for(n||(n=Array(e));++r<e;)n[r]=s[r];return n}function se(){if(!arguments.length)return[];var s=arguments[0];return be(s)?s:[s]}function wt(s,n){var r=[];return lt(s,function(e,f,i){n(e,f,i)&&r.push(e)}),r}function ht(s,n){var r=be(s)?nt:wt;return r(s,ae(n))}function mt(s,n){for(var r,e=-1,f=s.length;++e<f;){var i=n(s[e]);i!==void 0&&(r=r===void 0?i:r+i)}return r}var bt=Array.prototype,pe=bt.splice;function yt(s,n,r,e){var f=rt,i=-1,v=n.length,k=s;for(s===n&&(n=pt(n));++i<v;)for(var R=0,x=n[i],y=x;(R=f(k,y,R))>-1;)k!==s&&pe.call(k,R,1),pe.call(s,R,1);return s}function It(s,n){return s&&s.length&&n&&n.length?yt(s,n):s}var kt=at(It),xt=Array.prototype,Ft=xt.splice;function St(s,n){for(var r=s?n.length:0,e=r-1;r--;){var f=n[r];if(r==e||f!==i){var i=f;ct(f)?Ft.call(s,f,1):it(s,f)}}return s}function ke(s,n){var r=[];if(!(s&&s.length))return r;var e=-1,f=[],i=s.length;for(n=ae(n);++e<i;){var v=s[e];n(v,e,s)&&(r.push(v),f.push(e))}return St(s,f),r}function vt(s,n){return s&&s.length?mt(s,ae(n)):0}const we=s=>s.colId??"",Rt=s=>!!s.flex&&!M(s),_t=async(s,n,r)=>{const e=Date.now()+r;for(;Date.now()<e;){if(n())return!0;await le(100)}return console.warn(s),!1},Q=s=>s.colId,oe=s=>!!s.flex,ne=s=>!s.flex,he=s=>{const{modifyUpdating:n,anyUpdating:r}=l.useContext(Ie),[e,f]=l.useState(),[i,v]=l.useState(!1),[k,R]=l.useState(""),[x,y]=l.useState(),m=l.useRef(),S=l.useRef(!1),G=l.useRef([]),h=l.useRef(),[E,A]=l.useState(!1),O=l.useRef([]),xe=l.useCallback(t=>{e?.clearFocusedCell(),R(t)},[e]),Fe=l.useCallback(t=>y(kt(t,Ce)),[]);l.useEffect(()=>{e?.setGridOption("quickFilterText",k)},[e,k]);const C=l.useCallback((t,o)=>(o||(o=()=>{}),e&&!e.isDestroyed()?t(e):o()),[e]),Se=l.useCallback((...t)=>e?.getCellValue(...t),[e]),Y=l.useCallback(t=>{if(!e)return!1;const o=e.getRowNode(`${t}`);return o?(H(()=>!e.isDestroyed()&&e.ensureNodeVisible(o)),!0):!1},[e]),ve=l.useCallback(()=>{let t=0;try{e?.forEachNodeAfterFilterAndSort(o=>{throw t=parseInt(o.id??"0"),"expected exception - exit_loop"})}catch{}return t},[e]),Re=l.useCallback((t,o,c)=>{S.current=o,m.current=c,f(t),t?.setGridOption("quickFilterText",k),v(!!t)},[k]),_e=l.useCallback(()=>e?e.getDisplayedRowCount()?D(e.getRenderedNodes())?null:"rows-visible":"empty":null,[e]);l.useEffect(()=>{const t=window.__stepAgGrid||(window.__stepAgGrid={grids:{}});m.current&&(t.grids[m.current]={scrollRowIntoViewById:o=>{if(!Y(o))throw`scrollRowIntoView failed on grid '${m.current}' as row with id: '${o}' was not found`}})},[Y]);const J=l.useCallback(()=>{!e||e.isDestroyed()||(h.current=e.getFocusedCell()??void 0)},[e]),B=l.useCallback(()=>{const t=[];return C(o=>(o.forEachNode(c=>t.push(c.data.id)),t),()=>t)},[C]),U=l.useCallback(()=>{G.current=B()},[B]),ce=l.useCallback(()=>C(t=>q(dt(B(),G.current).map(o=>t.getRowNode(""+o))),()=>[]),[B,C]),ie=l.useCallback(t=>C(o=>q(t.map(c=>o.getRowNode(""+c))),()=>[]),[C]),_=l.useCallback((t=()=>!0)=>ht(e?.getColumns()?.map(o=>o.getColDef())??[],t),[e]),Ne=l.useCallback((t=()=>!0)=>q(_(t).map(we)),[_]),w=l.useCallback(({rowIds:t,select:o,flash:c,ifNoCellFocused:a=!1,retryCount:u=15})=>C(d=>{const g=t?ie(t):ce(),b=t&&g.length!==t.length,N=!t&&D(g);if((b||N)&&u>0){te(()=>w({rowIds:t,select:o,flash:c,ifNoCellFocused:a,retryCount:u-1}),250);return}const T=ot(g.filter(p=>!p.isSelected()),p=>p.data.id),P=T[0];if(P){H(()=>!d.isDestroyed()&&d.ensureNodeVisible(P));const p=_();if(!D(p)){const j=p[0],I=P.rowIndex;if(I!=null&&j!=null){const F=j.colId;F&&te(()=>{!d.isDestroyed()&&D(d.getEditingCells())&&(!a||d.getFocusedCell()==null)&&(d.setFocusedCell(I,F),d.setFocusedCell(I,ut))},100)}}}o&&(T.forEach(p=>p.setSelected(!0)),d.getSelectedNodes()?.forEach(p=>{p&&!g.includes(p)&&p.setSelected(!1)})),c&&te(()=>{try{!d.isDestroyed&&d.flashCells({rowNodes:g})}catch{}},250)}),[ce,ie,_,C]),De=l.useCallback(t=>w({rowIds:t,select:!0,flash:!1}),[w]),Ee=l.useCallback(t=>w({rowIds:t,select:!0,flash:!0}),[w]),Ue=l.useCallback(t=>w({rowIds:t,select:!1,flash:!0}),[w]),Pe=l.useCallback(async t=>{U(),await t(),w({rowIds:void 0,select:!0,flash:!1})},[w,U]),Ge=l.useCallback(async t=>{U(),await t(),w({rowIds:void 0,select:!0,flash:!0})},[w,U]),Ve=l.useCallback(async t=>{U(),await t(),w({rowIds:void 0,select:!1,flash:!0})},[w,U]),Te=l.useCallback((t,o)=>w({rowIds:[t],select:!1,flash:!1,ifNoCellFocused:o}),[w]),K=l.useCallback(()=>C(t=>t.getSelectedRows(),()=>[]),[C]),X=l.useCallback(()=>C(t=>{const o=[];return t.forEachNodeAfterFilter(c=>{c.isSelected()&&o.push(c.data)}),o}),[C]),Ae=l.useCallback(()=>K().map(t=>t.id),[K]),Oe=l.useCallback(()=>X().map(t=>t.id),[X]),Be=l.useCallback(()=>C(t=>et(t.getEditingCells()),()=>!1),[C]),$e=l.useCallback(()=>{C(t=>{const o=t.getSelectedNodes();D(o)||H(()=>!t.isDestroyed()&&t.ensureNodeVisible(ft(o)))})},[C]),We=l.useCallback(async({skipHeader:t,colIds:o,userSizedColIds:c}={})=>{if(!e||!e.getColumnState())return null;try{const a=o instanceof Set?o:new Set(o),u=()=>e.getColumnState().filter(F=>{const fe=F.colId;return(D(a)||a.has(fe))&&!c?.has(fe)}),d=()=>u().filter(oe),g=()=>u().filter(ne),b=d().map(Q);let N=0;b.forEach(I=>{const F=e.getColumnDef(I);N+=F?.flexAutoSizeWidth??200});const T=g().map(Q);e.autoSizeColumns({colIds:T,skipHeader:t});const P=()=>{const I=u().filter(F=>T.includes(F.colId));return vt(I.filter(F=>!F.hide),"width")};let p=P();const j=Date.now()+1e3;for(;Date.now()<j;){await le(40);const I=P();if(p!==I){p=I;break}}return N+=p,e.sizeColumnsToFit(),{width:N}}catch(a){return console.info("autosize failed",a),null}},[e]),ze=l.useCallback(t=>{e&&!e?.isDestroyed()&&e.sizeColumnsToFit(t)},[e]),Z=l.useCallback(()=>{!e||e.isDestroyed()||$.current||h.current&&(e.setFocusedCell(h.current.rowIndex,h.current.column),h.current=void 0)},[e]),V=l.useRef(!1);l.useEffect(()=>{V.current=E},[E]);const L=l.useCallback(async()=>{if(!S.current){V.current=!0;return}for(let t=0;t<5e3/200&&!V.current;t++)await le(200);V.current||console.error("externallySelectedItems did not sync with ag-grid selection")},[]),$=l.useRef(!1),ee=l.useCallback(async({rowId:t,colId:o})=>{if(!(!e||$.current)){$.current=!0;try{if(!await _t("startCellEditing failed as update still in progress, waited for 15 seconds",()=>!r(),15e3)||!e.getColumnDef(o))return;const a=e.getRowNode(`${t}`);if(!a)return;J(),!a.isSelected()&&(V.current=!1,A(!1),a.setSelected(!0,!0),await L());const d=a.rowIndex;d!=null&&H(()=>{e.isDestroyed()||e.startEditingCell({rowIndex:d,colKey:o})})}finally{$.current=!1}}},[r,e,J,L]),de=l.useRef(),W=l.useCallback(async()=>{Z(),await de.current?.()},[Z]),je=l.useCallback(t=>{de.current=t},[]),ue=l.useCallback(async t=>{if(!e)return!0;const o=()=>{const c=e.isDestroyed()?null:e.getFocusedCell(),a=c?.column,u=a?.getColDef(),d=c&&e.getDisplayedRowAtIndex(c?.rowIndex);return!!(d&&a&&u)&&a.isCellEditable(d)&&!u.cellEditorParams?.preventAutoEdit&&!u.cellRendererParams?.editAction};for(let c=0;c<50;c++){if(e.isDestroyed())return!0;h.current=void 0;const a=e.getFocusedCell();if(!(t===1?e.tabToNextCell():e.tabToPreviousCell()))break;if(e.isDestroyed())return!0;const d=e.getFocusedCell();if(a?.rowIndex!==d?.rowIndex||a?.column===d?.column)break;if(o()){const g=e.getFocusedCell();if(g){const N=e.getDisplayedRowAtIndex(g.rowIndex)?.data?.id;return N==null?!1:(await ee({rowId:N,colId:g.column.getColId()}),!0)}}}return!1},[e,ee]),He=l.useCallback(async(t,o,c,a)=>{try{return c?.(!0),await C(async u=>{const d=t.selectedRows;let g=!1;return await n(t.field??"",d.map(b=>b.id),async()=>{u.refreshCells({rowNodes:t.selectedRows,force:!0}),g=await o(d).catch(b=>(console.error("Exception during modifyUpdating",b),!1))}),u.refreshCells({rowNodes:d,force:!0}),u.isDestroyed()||(g&&!u.isDestroyed&&u.refreshClientSideRowModel(),(async()=>{const b=u.getFocusedCell();h.current&&b&&h.current.rowIndex==b.rowIndex&&h.current.column.getColId()==b.column.getColId()?(!a||!await ue(a))&&await W():await W()})()),g})}finally{c?.(!1)}},[C,n,W,ue]),qe=l.useMemo(()=>ge(t=>{try{e&&e.redrawRows(t?{rowNodes:t}:void 0)}catch(o){console.error(o)}},50),[e]),z=l.useMemo(()=>ge(()=>{if(!e||e?.isDestroyed())return;const t=()=>{const o=[];return e?.forEachNodeAfterFilter(c=>{o.push(c.id)}),o.join("|")};if(e){const o=e.getFocusedCell(),c=o&&t();e.onFilterChanged();const a=o&&t();c!==a&&e.clearFocusedCell()}},200),[e]),Me=l.useCallback(t=>{O.current.push(t),z()},[z]),Qe=l.useCallback(t=>{ke(O.current,o=>o===t),z()},[z]),Ye=l.useCallback(()=>!D(O.current),[]),Je=l.useCallback(t=>O.current.every(o=>o(t.data,t)),[]),Ke=l.useCallback(t=>!!t&&e?.getColumnDef(t)||void 0,[e]),Xe=l.useCallback(()=>{e?.showNoRowsOverlay()},[e]);l.useEffect(()=>{if(!e||!x)return;const t=_(a=>!a.lockVisible&&a.colId&&!x.includes(a.colId)&&!M(a)),o=t.some(Rt);if(!o){const a=_(M)[0];a&&t.push(a)}e.setColumnsVisible(q(t.map(we)),!0);const c=o?[...x,Ce]:x;e.setColumnsVisible(c,!1)},[x,_,e]);const Ze=l.useCallback(t=>{if(!e)return;const o=t?.fileName&&tt(st(t.fileName)),c=e.getColumnState().filter(a=>{const u=e.getColumnDef(a.colId);return!a.hide&&u&&!M(u)&&u.headerComponentParams?.exportable!==!1}).map(a=>a.colId);e.exportDataAsCsv({columnKeys:c,processCellCallback:re,...t,fileName:o})},[e]);return ye.jsx(Ct.Provider,{value:{gridRenderState:_e,getColDef:Ke,getColumns:_,getColumnIds:Ne,invisibleColumnIds:x,setInvisibleColumnIds:Fe,gridReady:i,prePopupOps:J,setApis:Re,setQuickFilter:xe,selectRowsById:De,selectRowsDiff:Pe,selectRowsByIdWithFlash:Ee,selectRowsWithFlashDiff:Ge,flashRows:Ue,flashRowsDiff:Ve,focusByRowById:Te,getSelectedRows:K,getFilteredSelectedRows:X,getSelectedRowIds:Ae,getFilteredSelectedRowIds:Oe,getFirstRowId:ve,getCellValue:Se,editingCells:Be,ensureRowVisible:Y,ensureSelectedRowIsVisible:$e,sizeColumnsToFit:ze,autoSizeColumns:We,startCellEditing:ee,resetFocusedCellAfterCellEditing:Z,updatingCells:He,redrawRows:qe,externallySelectedItemsAreInSync:E,setExternallySelectedItemsAreInSync:A,waitForExternallySelectedItemsToBeInSync:L,addExternalFilter:Me,removeExternalFilter:Qe,isExternalFilterPresent:Ye,doesExternalFilterPass:Je,downloadCsv:Ze,onBulkEditingComplete:W,setOnBulkEditingComplete:je,showNoRowsOverlay:Xe},children:s.children})},re=s=>{const n=i=>i==="-"||i==="â€“"||i==null?"":typeof i=="string"?i:JSON.stringify(i),r=s?.column?.getColDef();if(!r)return n(s.value);const e=r.valueFormatter;if(e==null)return s.value!=null&&typeof s.value!="string"&&console.error(`downloadCsv: valueFormatter missing and getValue is not a string, colId: ${r.colId}`),n(s.value);if(typeof e!="function")return console.error(`downloadCsv: String type (registered) value formatters are unsupported in downloadCsv, colId: ${r.colId}`),n(s.value);const f=e({...s,data:s.node?.data,colDef:r,node:null});return s.value!=null&&typeof f!="string"&&console.error(`downloadCsv: valueFormatter is returning non string values, colDef:", colId: ${r.colId}`),n(f)};try{Q.displayName="colStateId",Q.__docgenInfo={description:"",displayName:"colStateId",props:{}}}catch{}try{oe.displayName="colStateFlexed",oe.__docgenInfo={description:"",displayName:"colStateFlexed",props:{}}}catch{}try{ne.displayName="colStateNotFlexed",ne.__docgenInfo={description:"",displayName:"colStateNotFlexed",props:{}}}catch{}try{he.displayName="GridContextProvider",he.__docgenInfo={description:`Context for AgGrid operations.
Make sure you wrap AgGrid in this.
Also, make sure the provider is created in a separate component, otherwise it won't be found.`,displayName:"GridContextProvider",props:{}}}catch{}try{re.displayName="downloadCsvUseValueFormattersProcessCellCallback",re.__docgenInfo={description:`Aggrid defaults to using getters and ignores formatters.
step-ag-grid by default has a valueFormatter for every column that defaults to the getter if no valueFormatter
This function uses valueFormatter by default`,displayName:"downloadCsvUseValueFormattersProcessCellCallback",props:{}}}catch{}const me=s=>{const n=l.useRef({}),r=l.useRef({}),[e,f]=l.useState(0),i=l.useCallback(()=>{const y={};for(const m in n.current){const S=gt(n.current[m]);S.length&&(y[m]=S)}r.current=y,f(m=>m+1)},[]),v=l.useCallback(()=>Object.keys(r.current),[]),k=l.useCallback(async(y,m,S)=>{const G=[...m];se(y).forEach(h=>{(n.current[h]??(n.current[h]=[])).push(G)}),i(),await S(),se(y).forEach(h=>{const E=n.current[h];ke(E,A=>A===G)}),i()},[i]),R=l.useCallback(()=>!D(r.current),[]),x=l.useCallback((y,m)=>se(y).some(S=>r.current[S]?.includes(m)),[]);return ye.jsx(Ie.Provider,{value:{modifyUpdating:k,anyUpdating:R,checkUpdating:x,updatingCols:v,updatedDep:e},children:s.children})};try{me.displayName="GridUpdatingContextProvider",me.__docgenInfo={description:"",displayName:"GridUpdatingContextProvider",props:{}}}catch{}export{me as G,he as a,se as b,pt as c,kt as p};
