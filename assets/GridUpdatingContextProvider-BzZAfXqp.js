import{n as ge,w as we,q as R,y as Ye,O as Ke,f as Je,j as pe}from"./util-ijFjlinu.js";import{Q as Xe,R as j,S as ce,T as B,C as Ze,U as ie}from"./GridWrapper-BPNz-Kwc.js";import{r as s}from"./iframe-DlkmCGKI.js";import{V as Le,q as ee,W as et,d as tt,v as st,X as lt,I as he,T as $,Y as ot,N as X,Z as nt,b as rt,_ as at}from"./Grid-x2Pv4IEw.js";function ct(l,n){var r=-1,e=l.length;for(n||(n=Array(e));++r<e;)n[r]=l[r];return n}function Z(){if(!arguments.length)return[];var l=arguments[0];return ge(l)?l:[l]}function it(l,n){var r=[];return Xe(l,function(e,f,u){n(e,f,u)&&r.push(e)}),r}function ut(l,n){var r=ge(l)?Le:it;return r(l,ee(n))}function dt(l,n){for(var r,e=-1,f=l.length;++e<f;){var u=n(l[e]);u!==void 0&&(r=r===void 0?u:r+u)}return r}var ft=Array.prototype,ue=ft.splice;function Ct(l,n,r,e){var f=et,u=-1,x=n.length,I=l;for(l===n&&(n=ct(n));++u<x;)for(var F=0,k=n[u],y=k;(F=f(I,y,F))>-1;)I!==l&&ue.call(I,F,1),ue.call(l,F,1);return l}function gt(l,n){return l&&l.length&&n&&n.length?Ct(l,n):l}var wt=tt(gt),pt=Array.prototype,ht=pt.splice;function mt(l,n){for(var r=l?n.length:0,e=r-1;r--;){var f=n[r];if(r==e||f!==u){var u=f;st(f)?ht.call(l,f,1):lt(l,f)}}return l}function me(l,n){var r=[];if(!(l&&l.length))return r;var e=-1,f=[],u=l.length;for(n=ee(n);++e<u;){var x=l[e];n(x,e,l)&&(r.push(x),f.push(e))}return mt(l,f),r}function bt(l,n){return l&&l.length?dt(l,ee(n)):0}const de=l=>l.colId??"",yt=l=>!!l.flex&&!j(l),It=async(l,n,r)=>{const e=Date.now()+r;for(;Date.now()<e;){if(n())return!0;await we(100)}return console.warn(l),!1},fe=l=>{const{modifyUpdating:n,anyUpdating:r}=s.useContext(he),[e,f]=s.useState(),[u,x]=s.useState(!1),[I,F]=s.useState(""),[k,y]=s.useState(),h=s.useRef(),v=s.useRef(!1),E=s.useRef([]),p=s.useRef(),[N,U]=s.useState(!1),P=s.useRef([]),be=s.useCallback(t=>{e?.clearFocusedCell(),F(t)},[e]),ye=s.useCallback(t=>y(wt(t,ce)),[]);s.useEffect(()=>{e?.setGridOption("quickFilterText",I)},[e,I]);const g=s.useCallback((t,o)=>(o||(o=()=>{}),e&&!e.isDestroyed()?t(e):o()),[e]),q=s.useCallback(t=>{if(!e)return!1;const o=e.getRowNode(`${t}`);return o?($(()=>!e.isDestroyed()&&e.ensureNodeVisible(o)),!0):!1},[e]),Ie=s.useCallback(()=>{let t=0;try{e?.forEachNodeAfterFilterAndSort(o=>{throw t=parseInt(o.id??"0"),"expected exception - exit_loop"})}catch{}return t},[e]),ke=s.useCallback((t,o,c)=>{v.current=o,h.current=c,f(t),t?.setGridOption("quickFilterText",I),x(!!t)},[I]),ve=s.useCallback(()=>e?e.getDisplayedRowCount()?R(e.getRenderedNodes())?null:"rows-visible":"empty":null,[e]);s.useEffect(()=>{const t=window.__stepAgGrid||(window.__stepAgGrid={grids:{}});h.current&&(t.grids[h.current]={scrollRowIntoViewById:o=>{if(!q(o))throw`scrollRowIntoView failed on grid '${h.current}' as row with id: '${o}' was not found`}})},[q]);const z=s.useCallback(()=>{!e||e.isDestroyed()||(p.current=e.getFocusedCell()??void 0)},[e]),G=s.useCallback(()=>{const t=[];return g(o=>(o.forEachNode(c=>t.push(c.data.id)),t),()=>t)},[g]),D=s.useCallback(()=>{E.current=G()},[G]),te=s.useCallback(()=>g(t=>B(ot(G(),E.current).map(o=>t.getRowNode(""+o))),()=>[]),[G,g]),se=s.useCallback(t=>g(o=>B(t.map(c=>o.getRowNode(""+c))),()=>[]),[g]),S=s.useCallback((t=()=>!0)=>ut(e?.getColumns()?.map(o=>o.getColDef())??[],t),[e]),Re=s.useCallback((t=()=>!0)=>B(S(t).map(de)),[S]),w=s.useCallback(({rowIds:t,select:o,flash:c,ifNoCellFocused:a=!1,retryCount:d=15})=>g(i=>{const C=t?se(t):te(),m=t&&C.length!==t.length,A=!t&&R(C);if((m||A)&&d>0){X(()=>w({rowIds:t,select:o,flash:c,ifNoCellFocused:a,retryCount:d-1}),250);return}const ne=Ze(C.filter(b=>!b.isSelected()),b=>b.data.id),K=ne[0];if(K){$(()=>!i.isDestroyed()&&i.ensureNodeVisible(K));const b=S();if(!R(b)){const re=b[0],J=K.rowIndex;if(J!=null&&re!=null){const ae=re.colId;ae&&X(()=>{!i.isDestroyed()&&R(i.getEditingCells())&&(!a||i.getFocusedCell()==null)&&(i.setFocusedCell(J,ae),i.setFocusedCell(J,"ag-Grid-SelectionColumn"))},100)}}}o&&(ne.forEach(b=>b.setSelected(!0)),i.getSelectedNodes()?.forEach(b=>{b&&!C.includes(b)&&b.setSelected(!1)})),c&&X(()=>{try{!i.isDestroyed&&i.flashCells({rowNodes:C})}catch{}},250)}),[te,se,S,g]),xe=s.useCallback(t=>w({rowIds:t,select:!0,flash:!1}),[w]),Fe=s.useCallback(t=>w({rowIds:t,select:!0,flash:!0}),[w]),Se=s.useCallback(t=>w({rowIds:t,select:!1,flash:!0}),[w]),Ne=s.useCallback(async t=>{D(),await t(),w({rowIds:void 0,select:!0,flash:!1})},[w,D]),De=s.useCallback(async t=>{D(),await t(),w({rowIds:void 0,select:!0,flash:!0})},[w,D]),Ee=s.useCallback(async t=>{D(),await t(),w({rowIds:void 0,select:!1,flash:!0})},[w,D]),_e=s.useCallback((t,o)=>w({rowIds:[t],select:!1,flash:!1,ifNoCellFocused:o}),[w]),H=s.useCallback(()=>g(t=>t.getSelectedRows(),()=>[]),[g]),W=s.useCallback(()=>g(t=>{const o=[];return t.forEachNodeAfterFilter(c=>{c.isSelected()&&o.push(c.data)}),o}),[g]),Ue=s.useCallback(()=>H().map(t=>t.id),[H]),Pe=s.useCallback(()=>W().map(t=>t.id),[W]),Ge=s.useCallback(()=>g(t=>Ye(t.getEditingCells()),()=>!1),[g]),Te=s.useCallback(()=>{g(t=>{const o=t.getSelectedNodes();R(o)||$(()=>!t.isDestroyed()&&t.ensureNodeVisible(nt(o)))})},[g]),Ve=s.useCallback(({skipHeader:t,colIds:o,userSizedColIds:c,includeFlex:a}={})=>{if(!e||!e.getColumnState())return null;const d=o instanceof Set?o:new Set(o),i=e.getColumnState()?.filter?.(C=>{const m=C.colId;return(R(d)||d.has(m))&&!c?.has(m)&&(a||!C.flex)});return R(i)||e.autoSizeColumns(i.map(C=>C.colId),t),{width:bt(e.getColumnState().filter(C=>!C.hide),"width")}},[e]),Oe=s.useCallback(t=>{e&&!e?.isDestroyed()&&e.sizeColumnsToFit(t)},[e]),M=s.useCallback(()=>{!e||e.isDestroyed()||T.current||p.current&&(e.setFocusedCell(p.current.rowIndex,p.current.column),p.current=void 0)},[e]),_=s.useRef(!1);s.useEffect(()=>{_.current=N},[N]);const Q=s.useCallback(async()=>{if(!v.current){_.current=!0;return}for(let t=0;t<5e3/200&&!_.current;t++)await we(200);_.current||console.error("externallySelectedItems did not sync with ag-grid selection")},[]),T=s.useRef(!1),Y=s.useCallback(async({rowId:t,colId:o})=>{if(!(!e||T.current)){T.current=!0;try{if(!await It("startCellEditing failed as update still in progress, waited for 15 seconds",()=>!r(),15e3)||!e.getColumnDef(o))return;const a=e.getRowNode(`${t}`);if(!a)return;z(),!a.isSelected()&&(_.current=!1,U(!1),a.setSelected(!0,!0),await Q());const i=a.rowIndex;i!=null&&$(()=>{e.isDestroyed()||e.startEditingCell({rowIndex:i,colKey:o})})}finally{T.current=!1}}},[r,e,z,Q]),le=s.useRef(),V=s.useCallback(async()=>{M(),await le.current?.()},[M]),Ae=s.useCallback(t=>{le.current=t},[]),oe=s.useCallback(async t=>{if(!e)return!0;const o=()=>{const c=e.isDestroyed()?null:e.getFocusedCell(),a=c?.column,d=a?.getColDef(),i=c&&e.getDisplayedRowAtIndex(c?.rowIndex);return!!(i&&a&&d)&&a.isCellEditable(i)&&!d.cellEditorParams?.preventAutoEdit&&!d.cellRendererParams?.editAction};for(let c=0;c<50;c++){if(e.isDestroyed())return!0;p.current=void 0;const a=e.getFocusedCell();if(!(t===1?e.tabToNextCell():e.tabToPreviousCell()))break;if(e.isDestroyed())return!0;const i=e.getFocusedCell();if(a?.rowIndex!==i?.rowIndex||a?.column===i?.column)break;if(o()){const C=e.getFocusedCell();if(C){const A=e.getDisplayedRowAtIndex(C.rowIndex)?.data?.id;return A==null?!1:(await Y({rowId:A,colId:C.column.getColId()}),!0)}}}return!1},[e,Y]),Be=s.useCallback(async(t,o,c,a)=>{try{return c?.(!0),await g(async d=>{const i=t.selectedRows;let C=!1;return await n(t.field??"",i.map(m=>m.id),async()=>{d.refreshCells({rowNodes:t.selectedRows,force:!0}),C=await o(i).catch(m=>(console.error("Exception during modifyUpdating",m),!1))}),d.refreshCells({rowNodes:i,force:!0}),d.isDestroyed()||(C&&!d.isDestroyed&&d.refreshClientSideRowModel(),(async()=>{const m=d.getFocusedCell();p.current&&m&&p.current.rowIndex==m.rowIndex&&p.current.column.getColId()==m.column.getColId()?(!a||!await oe(a))&&await V():await V()})()),C})}finally{c?.(!1)}},[g,n,V,oe]),$e=s.useMemo(()=>ie(t=>{try{e&&e.redrawRows(t?{rowNodes:t}:void 0)}catch(o){console.error(o)}},50),[e]),O=s.useMemo(()=>ie(()=>{if(!e||e?.isDestroyed())return;const t=()=>{const o=[];return e?.forEachNodeAfterFilter(c=>{o.push(c.id)}),o.join("|")};if(e){const o=e.getFocusedCell(),c=o&&t();e.onFilterChanged();const a=o&&t();c!==a&&e.clearFocusedCell()}},200),[e]),je=s.useCallback(t=>{P.current.push(t),O()},[O]),qe=s.useCallback(t=>{me(P.current,o=>o===t),O()},[O]),ze=s.useCallback(()=>!R(P.current),[]),He=s.useCallback(t=>P.current.every(o=>o(t.data,t)),[]),We=s.useCallback(t=>!!t&&e?.getColumnDef(t)||void 0,[e]),Me=s.useCallback(()=>{e?.showNoRowsOverlay()},[e]);s.useEffect(()=>{if(!e||!k)return;const t=S(a=>!a.lockVisible&&a.colId&&!k.includes(a.colId)&&!j(a)),o=t.some(yt);if(!o){const a=S(j)[0];a&&t.push(a)}e.setColumnsVisible(B(t.map(de)),!0);const c=o?[...k,ce]:k;e.setColumnsVisible(c,!1)},[k,S,e]);const Qe=s.useCallback(t=>{if(!e)return;const o=t?.fileName&&Ke(Je(t.fileName)),c=e.getColumnState().filter(a=>{const d=e.getColumnDef(a.colId);return!a.hide&&d&&!j(d)&&d.headerComponentParams?.exportable!==!1}).map(a=>a.colId);e.exportDataAsCsv({columnKeys:c,processCellCallback:L,...t,fileName:o})},[e]);return pe.jsx(rt.Provider,{value:{gridRenderState:ve,getColDef:We,getColumns:S,getColumnIds:Re,invisibleColumnIds:k,setInvisibleColumnIds:ye,gridReady:u,prePopupOps:z,setApis:ke,setQuickFilter:be,selectRowsById:xe,selectRowsDiff:Ne,selectRowsByIdWithFlash:Fe,selectRowsWithFlashDiff:De,flashRows:Se,flashRowsDiff:Ee,focusByRowById:_e,getSelectedRows:H,getFilteredSelectedRows:W,getSelectedRowIds:Ue,getFilteredSelectedRowIds:Pe,getFirstRowId:Ie,editingCells:Ge,ensureRowVisible:q,ensureSelectedRowIsVisible:Te,sizeColumnsToFit:Oe,autoSizeColumns:Ve,startCellEditing:Y,resetFocusedCellAfterCellEditing:M,updatingCells:Be,redrawRows:$e,externallySelectedItemsAreInSync:N,setExternallySelectedItemsAreInSync:U,waitForExternallySelectedItemsToBeInSync:Q,addExternalFilter:je,removeExternalFilter:qe,isExternalFilterPresent:ze,doesExternalFilterPass:He,downloadCsv:Qe,onBulkEditingComplete:V,setOnBulkEditingComplete:Ae,showNoRowsOverlay:Me},children:l.children})},L=l=>{const n=u=>u==="-"||u==="–"||u==null?"":typeof u=="string"?u:JSON.stringify(u),r=l?.column?.getColDef();if(!r)return n(l.value);const e=r.valueFormatter;if(e==null)return l.value!=null&&typeof l.value!="string"&&console.error(`downloadCsv: valueFormatter missing and getValue is not a string, colId: ${r.colId}`),n(l.value);if(typeof e!="function")return console.error(`downloadCsv: String type (registered) value formatters are unsupported in downloadCsv, colId: ${r.colId}`),n(l.value);const f=e({...l,data:l.node?.data,colDef:r,node:null});return l.value!=null&&typeof f!="string"&&console.error(`downloadCsv: valueFormatter is returning non string values, colDef:", colId: ${r.colId}`),n(f)};try{fe.displayName="GridContextProvider",fe.__docgenInfo={description:`Context for AgGrid operations.
Make sure you wrap AgGrid in this.
Also, make sure the provider is created in a separate component, otherwise it won't be found.`,displayName:"GridContextProvider",props:{}}}catch{}try{L.displayName="downloadCsvUseValueFormattersProcessCellCallback",L.__docgenInfo={description:`Aggrid defaults to using getters and ignores formatters.
step-ag-grid by default has a valueFormatter for every column that defaults to the getter if no valueFormatter
This function uses valueFormatter by default`,displayName:"downloadCsvUseValueFormattersProcessCellCallback",props:{}}}catch{}const Ce=l=>{const n=s.useRef({}),r=s.useRef({}),[e,f]=s.useState(0),u=s.useCallback(()=>{const y={};for(const h in n.current){const v=at(n.current[h]);v.length&&(y[h]=v)}r.current=y,f(h=>h+1)},[]),x=s.useCallback(()=>Object.keys(r.current),[]),I=s.useCallback(async(y,h,v)=>{const E=[...h];Z(y).forEach(p=>{(n.current[p]??(n.current[p]=[])).push(E)}),u(),await v(),Z(y).forEach(p=>{const N=n.current[p];me(N,U=>U===E)}),u()},[u]),F=s.useCallback(()=>!R(r.current),[]),k=s.useCallback((y,h)=>Z(y).some(v=>r.current[v]?.includes(h)),[]);return pe.jsx(he.Provider,{value:{modifyUpdating:I,anyUpdating:F,checkUpdating:k,updatingCols:x,updatedDep:e},children:l.children})};try{Ce.displayName="GridUpdatingContextProvider",Ce.__docgenInfo={description:"",displayName:"GridUpdatingContextProvider",props:{}}}catch{}export{Ce as G,fe as a,Z as b,ct as c,wt as p};
